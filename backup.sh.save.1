#!/bin/bash

src=$1
trgt=$2
k=$3
echo $src $trgt $k
d=`date`
date_no_space=`echo -e $d | sed -e 's/ /_/g'`
date_no_colons=`echo -e $date_no_space | sed -e 's/:/_/g'`
echo "The Date of the backup is: [ $d ]"
echo -e "The modifed date is: [ $date_no_colons ]\n"
if [[ $# -ne 3 ]]; then
	echo "Usage: ./backup.sh source_directory destination_directory backup_key"
else
	mkdir "$trgt/$date_no_colons"
	echo "[+] Working on it Now"
	for d in $src/*/; do
		if [ -d $d ]; then
			dirname=`basename "${d}"`
			new_f="$dirname""_""$date_no_colons"
			tar  -cvzf "$trgt""/""$new_f"".tar.gz" -P $d
			tar_name="$trgt""/""$new_f"".tar.gz"
			gpg -e -r mina146@aucegypt.edu $tar_namegpg --pinentry-mode loopback --passphrase minagamed --symmetric mina.txt
			gpg --pinentry-mode loopback --passphrase $k --symmetric mina.txt
			shred -u $tar_name
		fi
	done
fi
